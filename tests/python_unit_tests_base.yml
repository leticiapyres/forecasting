# Pull request against these pipelines will trigger this build
pr:
- staging
- master

# Any commit to this branch will trigger the build.
trigger:
- staging
- master

pool:
  name: ForecastingBP
  vmImage: 'forecastingtestmachine'

steps:

- bash: |
    #echo "##vso[task.prependpath]/data/anaconda/bin"
    echo ". /data/anaconda/etc/profile.d/conda.sh" >> ~./bashrc
  displayName: Add Conda to PATH

- bash: |
    . /anaconda/etc/profile.d/conda.sh
    conda activate forecasting_base
  displayName: 'Build Configuration'

- bash: |
    #cd image_classification
    pytest tests/unit -m "not notebooks and not spark and not gpu" --junitxml=reports/test-unit.xml
    conda deactivate
  displayName: 'Run Unit tests'

- task: PublishTestResults@2
  inputs:
    testResultsFiles: '**/test-unitttest.xml'
    testRunTitle: 'Test results for PyTest'